---
title: "Data Access History"
output: github_document
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=F, echo=F}
library(glue)
library(tidyverse)
knitr::opts_chunk$set(echo = F, message = F, warning = F)
```

# Introduction

Below is an overview of the full data accessing history over the course of this project.
This overview is automatically generated based on the automated Git commits that were triggered whenever a new data object was detected.
It also contains information on other milestones, such as the submission of preregistrations and finalizing specific analyses.
For more information on the data access workflow, see the [README file](https://github.com/stefanvermeent/abcd_ddm/README.md).

Each top-level bullet provides the following information:

  - Timestamp: Information on when the data was accessed, together with a description of which data was accessed
  - Milestone: Keyword identifying the type of event (e.g., data access or preregistration).
  - Data MD5 hash: Unique identifier of the data file that was read in. An MD5 hash is generated based on the content of an object. It changes as soon as anything about the object changes (e.g., when rows get filtered or variables get added). Thus, the MD5 hash can be used to verify that the accessed data object did not contain any variables or rows that could have biased the analyses.
  - Link to code snippet: Link to an `.Rmd` file located in the `.gitlog/` folder, containing the exact code that was used to read in the data.


# Overview


```{r results ='asis'}
gert::git_log() |> 
  select(commit, author, time, message) |>
  (function(.) filter(., str_detect(string = .$message, pattern = "^\\[\\[")))() |> 
  separate(message, into = c("message", "data_hash", 'code'), sep = "\n") |> 
  separate(message, into = c("milestone", "description"), sep = "\\]\\]\\s") %>% 
  mutate(
    milestone = map_chr(milestone, function(milestone) {
      milestone |> 
        str_remove("\\[\\[") |>
        str_replace("_", " ") |> 
        str_to_title()
    }),
    data_hash = str_remove(data_hash, "^object_hash ")
  ) |> 
  select(time, commit, milestone, description, code, data_hash) |> 
  mutate(
    code = str_replace_all(code, "\\|\\>", "\\|\\>\\\n"),
    link_to_git = paste0(
      "<anonymized repository>"
     # gert::git_remote_list()$url |> str_remove(string = _, pattern = "\\.git$"), "/tree/", commit)
    )
  ) |>
  arrange(time) |> 
  glue_data("  - **[{time}]({link_to_git}): {description}**
        - **Milestone:** {milestone}
        - **Data MD5 hash**: {data_hash}
        - [Link to code snippet](https://anonymous.4open.science/r/anon-255D/.gitlog/{commit}.R)
        \n
    ")

```